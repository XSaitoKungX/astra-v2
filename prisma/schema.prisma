generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// â”€â”€â”€ Guild Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Guild {
  id        String   @id // Discord Guild ID
  name      String
  icon      String?
  ownerId   String
  locale    String   @default("en")
  prefix    String   @default("/")
  premium   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Module settings
  modLogChannel   String?
  welcomeChannel  String?
  goodbyeChannel  String?
  logChannel      String?  // legacy â€” fallback for all events
  verifyChannel   String?
  verifyRole      String?
  muteRole        String?
  djRole          String?

  // Per-event log channels
  logMessageEvents  String?  // message edit/delete
  logMemberEvents   String?  // join/leave/role changes
  logVoiceEvents    String?  // voice join/leave/move
  logServerEvents   String?  // channel/role/server changes
  logModEvents      String?  // mod actions (ban/kick/timeout/warn)

  // Relations
  commandLogs CommandLog[]
  warnings    Warning[]
  modActions  ModAction[]

  @@map("guilds")
}

// â”€â”€â”€ Command Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model CommandLog {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  command   String
  args      String?
  channel   String?
  success   Boolean  @default(true)
  error     String?
  createdAt DateTime @default(now())

  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@index([guildId])
  @@index([userId])
  @@index([createdAt])
  @@map("command_logs")
}

// â”€â”€â”€ AutoMod Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model AutoMod {
  id               String  @id // Guild ID
  enabled          Boolean @default(false)

  // Anti-Spam
  antiSpam             Boolean @default(false)
  antiSpamLimit        Int     @default(5)     // messages per interval
  antiSpamInterval     Int     @default(5)     // seconds
  antiSpamExemptRoles  String  @default("[]")  // JSON array
  antiSpamExemptChannels String @default("[]") // JSON array

  // Anti-Link
  antiLink             Boolean @default(false)
  antiLinkMode         String  @default("blacklist") // "blacklist" or "whitelist"
  antiLinkList         String  @default("[]")  // JSON array of domains/URLs
  antiLinkExemptRoles  String  @default("[]")
  antiLinkExemptChannels String @default("[]")

  // Anti-Invite
  antiInvite             Boolean @default(false)
  antiInviteMode         String  @default("blacklist") // "blacklist" or "whitelist"
  antiInviteList         String  @default("[]")  // JSON array of invite codes/server IDs
  antiInviteExemptRoles  String  @default("[]")
  antiInviteExemptChannels String @default("[]")

  // Bad Words
  badWords             Boolean @default(false)
  badWordsList         String  @default("[]")  // JSON array
  badWordsExemptRoles  String  @default("[]")
  badWordsExemptChannels String @default("[]")

  // Caps Filter
  capsFilter             Boolean @default(false)
  capsThreshold          Int     @default(70)    // percentage
  capsMinLength          Int     @default(10)    // min message length to check
  capsExemptRoles        String  @default("[]")
  capsExemptChannels     String  @default("[]")

  // Emoji Filter
  emojiFilter             Boolean @default(false)
  emojiLimit              Int     @default(10)
  emojiExemptRoles        String  @default("[]")
  emojiExemptChannels     String  @default("[]")

  // Mention Spam
  mentionSpam             Boolean @default(false)
  mentionSpamLimit        Int     @default(5)    // max mentions per message
  mentionSpamExemptRoles  String  @default("[]")
  mentionSpamExemptChannels String @default("[]")

  // Duplicate Messages
  duplicateFilter             Boolean @default(false)
  duplicateFilterCount        Int     @default(3)    // same message X times
  duplicateFilterInterval     Int     @default(60)   // within X seconds
  duplicateFilterExemptRoles  String  @default("[]")
  duplicateFilterExemptChannels String @default("[]")

  // Global settings
  logChannel      String?
  exemptRoles     String  @default("[]")  // JSON array â€” global exempt roles (legacy, still checked)
  exemptChannels  String  @default("[]")  // JSON array â€” global exempt channels (legacy, still checked)

  @@map("automod")
}

// â”€â”€â”€ Warnings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Warning {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  moderator String
  reason    String
  createdAt DateTime @default(now())

  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@index([guildId, userId])
  @@index([createdAt])
  @@map("warnings")
}

// â”€â”€â”€ Mod Actions (ban, kick, timeout, etc.) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ModAction {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  moderator String
  action    String   // ban, kick, timeout, warn, clear, slowmode, lock, unlock
  reason    String?
  duration  Int?     // in seconds, for timeout
  createdAt DateTime @default(now())

  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@index([guildId, userId])
  @@index([guildId, action])
  @@index([createdAt])
  @@map("mod_actions")
}

// â”€â”€â”€ User Profiles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserProfile {
  id            String   @id // Discord User ID
  bio           String?  @db.Text
  accentColor   String?  // hex color for profile accent
  bgImage       String?  // custom background image URL
  bgColor       String?  // fallback background color
  layout        String   @default("default") // default, compact, minimal
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  links UserProfileLink[]

  @@map("user_profiles")
}

// â”€â”€â”€ User Profile Links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserProfileLink {
  id        Int      @id @default(autoincrement())
  profileId String
  label     String   // e.g. "GitHub", "Twitter", "Website"
  url       String   // original URL
  slug      String   @unique // short link slug for /go/:slug
  icon      String?  // icon identifier
  order     Int      @default(0)
  createdAt DateTime @default(now())

  profile UserProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("user_profile_links")
}

// â”€â”€â”€ User Stats (global, aggregated across all servers) â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserStats {
  id            String   @id // Discord User ID
  messages      Int      @default(0)
  words         Int      @default(0)
  emojis        Int      @default(0)
  gifs          Int      @default(0)
  stickers      Int      @default(0)
  voiceMinutes  Int      @default(0)
  invites       Int      @default(0)
  level         Int      @default(0)
  xp            Int      @default(0)
  cash          Int      @default(0)
  bank          Int      @default(0)
  birthday      String?  // ISO date string
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  musicStats UserMusicStats[]

  @@map("user_stats")
}

// â”€â”€â”€ User Music Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserMusicStats {
  id         Int      @id @default(autoincrement())
  userId     String
  songName   String
  artistName String
  platform   String   // youtube, spotify, soundcloud, apple
  playCount  Int      @default(1)
  lastPlayed DateTime @default(now())

  user UserStats @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, songName, artistName])
  @@index([userId])
  @@index([userId, playCount])
  @@map("user_music_stats")
}

// â”€â”€â”€ Server Reviews â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ServerReview {
  id        Int      @id @default(autoincrement())
  serverId  String   // Discord Guild ID
  userId    String   // Discord User ID
  username  String   // cached display name
  avatar    String?  // cached avatar URL
  rating    Int      // 1-5 stars
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([serverId, userId]) // one review per user per server
  @@index([serverId])
  @@index([serverId, rating])
  @@map("server_reviews")
}

// â”€â”€â”€ Server Stats (aggregated) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ServerStats {
  id            String   @id // Discord Guild ID
  messages      Int      @default(0)
  words         Int      @default(0)
  voiceMinutes  Int      @default(0)
  totalEconomy  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("server_stats")
}

// â”€â”€â”€ User Level (per-server leveling data) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserLevel {
  id            Int      @id @default(autoincrement())
  guildId       String
  userId        String
  xp            Int      @default(0)       // current message XP (resets on level up)
  totalXp       Int      @default(0)       // total message XP (cumulative)
  level         Int      @default(0)       // message level
  messages      Int      @default(0)
  voiceMinutes  Int      @default(0)
  voiceXp       Int      @default(0)       // current voice XP (resets on level up)
  voiceTotalXp  Int      @default(0)       // total voice XP (cumulative)
  voiceLevel    Int      @default(0)       // voice level
  lastMessageXp DateTime? // cooldown tracking
  lastVoiceXp   DateTime? // voice XP tracking
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([guildId, userId])
  @@index([guildId, level(sort: Desc)])
  @@index([guildId, totalXp(sort: Desc)])
  @@index([guildId, voiceLevel(sort: Desc)])
  @@index([guildId, voiceTotalXp(sort: Desc)])
  @@index([userId])
  @@map("user_levels")
}

// â”€â”€â”€ Level Settings (per-server configuration) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model LevelSettings {
  id                  String  @id // Guild ID
  enabled             Boolean @default(false)
  messageXpMin        Int     @default(15)
  messageXpMax        Int     @default(25)
  messageCooldown     Int     @default(60)    // seconds between XP gains
  voiceXpPerMinute    Int     @default(5)
  voiceXpCooldown     Int     @default(60)    // seconds
  xpMultiplier        Float   @default(1.0)
  levelUpChannel      String? // channel ID for level-up announcements, null = current channel
  levelUpMode         String  @default("embed") // "embed", "message", "both"
  levelUpMessage      String? @db.Text // custom message, supports {user} {level} {role} placeholders
  levelUpEmbed        String? @db.Text // JSON: full embed config (title, description, color, thumbnail, image, footer, author, fields)
  stackRoles          Boolean @default(true)  // keep previous role rewards
  noXpRoles           String  @default("[]")  // JSON array of role IDs that don't earn XP
  noXpChannels        String  @default("[]")  // JSON array of channel IDs where XP is disabled

  roleRewards LevelRoleReward[]

  @@map("level_settings")
}

// â”€â”€â”€ Level Role Rewards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model LevelRoleReward {
  id       Int    @id @default(autoincrement())
  guildId  String
  level    Int
  roleId   String

  settings LevelSettings @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@unique([guildId, level, roleId])
  @@index([guildId])
  @@map("level_role_rewards")
}

// â”€â”€â”€ Rank Card Config (per-user customization) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model RankCardConfig {
  id              String  @id // Discord User ID
  theme           String  @default("default") // default, dark, light, anime, neon, pastel, ocean, sunset, sakura
  backgroundColor String  @default("#23272a")
  progressColor   String  @default("#7C3AED") // progress bar fill
  textColor       String  @default("#ffffff")
  accentColor     String  @default("#7C3AED")
  overlayOpacity  Int     @default(90)        // 0-100
  backgroundImage String? // URL to custom background image
  layout          String  @default("default") // default, compact, minimal

  @@map("rank_card_configs")
}

// â”€â”€â”€ Bot Reviews (website reviews for the bot itself) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model BotReview {
  id        Int      @id @default(autoincrement())
  userId    String   // Discord User ID
  username  String   // cached display name
  avatar    String?  // cached avatar URL
  rating    Int      // 1-5 stars
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId]) // one review per user
  @@index([rating])
  @@index([createdAt])
  @@map("bot_reviews")
}

// â”€â”€â”€ Economy Settings (per-guild configuration) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model EconomySettings {
  id                String  @id // Guild ID
  enabled           Boolean @default(false)
  currencyName      String  @default("Coins")
  currencySymbol    String  @default("ðŸª™")
  startingBalance   Int     @default(100)
  dailyMin          Int     @default(100)
  dailyMax          Int     @default(300)
  dailyStreak       Int     @default(50)   // bonus per streak day
  workMin           Int     @default(50)
  workMax           Int     @default(200)
  workCooldown      Int     @default(3600) // seconds
  robChance         Int     @default(40)   // percent
  robMin            Int     @default(10)   // percent of target's cash
  robMax            Int     @default(30)   // percent of target's cash
  robCooldown       Int     @default(7200) // seconds
  robFine           Int     @default(20)   // percent of own cash lost on fail
  bankInterest      Float   @default(0.5)  // percent per day
  maxBankBalance    Int     @default(1000000)
  logChannel        String?

  shopItems ShopItem[]

  @@map("economy_settings")
}

// â”€â”€â”€ Economy User (per-guild per-user balances) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model EconomyUser {
  id            Int       @id @default(autoincrement())
  guildId       String
  userId        String
  cash          Int       @default(0)
  bank          Int       @default(0)
  totalEarned   Int       @default(0)
  totalSpent    Int       @default(0)
  dailyStreak   Int       @default(0)
  lastDaily     DateTime?
  lastWork      DateTime?
  lastRob       DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  inventory UserInventory[]

  @@unique([guildId, userId])
  @@index([guildId, cash(sort: Desc)])
  @@index([guildId, bank(sort: Desc)])
  @@index([userId])
  @@map("economy_users")
}

// â”€â”€â”€ Shop Items (per-guild) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ShopItem {
  id          Int      @id @default(autoincrement())
  guildId     String
  name        String
  description String?
  price       Int
  emoji       String   @default("ðŸ“¦")
  type        String   @default("custom") // role, giftcard, boost_xp, boost_coins, boost_daily, custom
  category    String   @default("general") // general, roles, boosts, specials
  roleId      String?  // for type=role: grants this role on purchase
  boostValue  Float?   // for boosts: multiplier (e.g. 1.5 = +50%)
  duration    Int?     // for boosts: duration in hours
  maxStock    Int?     // null = unlimited
  sold        Int      @default(0)
  usable      Boolean  @default(false) // can be "used" from inventory
  useMessage  String?  // message shown when used
  requireRole String?  // optional: require this role to buy
  enabled     Boolean  @default(true)
  createdAt   DateTime @default(now())

  settings  EconomySettings @relation(fields: [guildId], references: [id], onDelete: Cascade)
  inventory UserInventory[]

  @@index([guildId])
  @@index([guildId, category])
  @@map("shop_items")
}

// â”€â”€â”€ User Inventory (per-guild per-user items) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserInventory {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  itemId    Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())

  owner EconomyUser @relation(fields: [guildId, userId], references: [guildId, userId], onDelete: Cascade)
  item  ShopItem    @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@unique([guildId, userId, itemId])
  @@index([guildId, userId])
  @@map("user_inventory")
}

// â”€â”€â”€ Active Boosts (per-guild per-user) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ActiveBoost {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  type      String   // boost_xp, boost_coins, boost_daily
  value     Float    // multiplier (e.g. 1.5)
  expiresAt DateTime
  itemId    Int?     // which shop item activated this
  createdAt DateTime @default(now())

  @@index([guildId, userId])
  @@index([guildId, userId, type])
  @@map("active_boosts")
}

// â”€â”€â”€ Economy Transactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model EconomyTransaction {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  type      String   // daily, work, rob, rob_fail, deposit, withdraw, buy, sell, use, gamble_win, gamble_lose, transfer, interest
  amount    Int
  balance   Int      // balance after transaction
  targetId  String?  // for rob/transfer: the other user
  note      String?
  createdAt DateTime @default(now())

  @@index([guildId, userId])
  @@index([guildId, createdAt])
  @@index([guildId, type])
  @@map("economy_transactions")
}

// â”€â”€â”€ Bot Settings (global, owner-only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model BotSettings {
  id                   String  @id @default("default") // singleton row
  name                 String  @default("Astra")
  language             String  @default("en")
  status               String  @default("online")       // online, idle, dnd, invisible
  activityType         String  @default("PLAYING")     // PLAYING, LISTENING, WATCHING, STREAMING, COMPETING
  activityMessage      String  @default("{servers} servers | /help")
  activityRotation     Boolean @default(false)           // rotate through multiple activities
  activityInterval     Int     @default(30)              // seconds between rotation
  activityRandomOrder  Boolean @default(false)           // random rotation instead of sequential
  activities           String  @default("[]")            // JSON array of { type, message }
  streamingUrl         String? // required if activityType is STREAMING
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("bot_settings")
}

// â”€â”€â”€ Server Team Members (custom team management) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ServerTeamMember {
  id         Int      @id @default(autoincrement())
  serverId   String   // Discord Guild ID
  userId     String   // Discord User ID
  roleLabel  String   // e.g. "Owner", "Admin", "Moderator", "Support", custom label
  category   String   @default("Staff") // grouping category e.g. "Management", "Moderation", "Support"
  order      Int      @default(0)       // sort order within category
  addedBy    String   // who added this member (userId)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([serverId, userId]) // one entry per user per server
  @@index([serverId])
  @@index([serverId, category])
  @@map("server_team_members")
}

// â”€â”€â”€ Ticket Settings (per-guild) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model TicketSettings {
  id              String  @id // Guild ID
  enabled         Boolean @default(false)
  categoryId      String? // Discord category channel for tickets
  logChannel      String? // Channel for ticket logs
  transcriptChannel String? // Channel for transcript posts
  staffRoles      String  @default("[]") // JSON array of role IDs
  maxOpen         Int     @default(3)    // max open tickets per user
  dmOnClose       Boolean @default(true) // DM user transcript on close
  autoClose       Boolean @default(false)
  autoCloseHours  Int     @default(48)   // hours of inactivity before auto-close
  closeConfirm    Boolean @default(true) // require confirmation to close
  namingScheme    String  @default("ticket-{number}") // {number}, {user}, {topic}
  welcomeMessage          String? @db.Text // custom message when ticket opens
  welcomeMessageMode      String  @default("message") // message, embed, both
  welcomeEmbedTitle       String? // embed title for welcome message
  welcomeEmbedDescription String? @db.Text // embed description for welcome message
  welcomeEmbedColor       String  @default("#7C3AED") // embed color for welcome message

  panels TicketPanel[]

  @@map("ticket_settings")
}

// â”€â”€â”€ Ticket Panels (embed panels with buttons to open tickets) â”€â”€
model TicketPanel {
  id          Int      @id @default(autoincrement())
  guildId     String
  channelId   String   // channel where panel is posted
  messageId   String?  // Discord message ID of the panel
  title       String   @default("Support Tickets")
  description String?  @db.Text
  color       String   @default("#7C3AED")
  emoji       String   @default("ðŸŽ«")
  buttonLabel     String   @default("Open Ticket")
  buttonStyle     String   @default("PRIMARY") // PRIMARY, SECONDARY, SUCCESS, DANGER
  topic           String   @default("general") // ticket category/topic
  panelMode       String   @default("embed") // message, embed, both
  interactionType String   @default("button") // button, reaction, dropdown
  createdAt   DateTime @default(now())

  settings   TicketSettings   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  tickets    Ticket[]
  categories TicketCategory[]

  @@index([guildId])
  @@index([guildId, channelId])
  @@map("ticket_panels")
}

// â”€â”€â”€ Ticket Categories (per-panel, e.g. Support, Bewerbung, Bug Report) â”€â”€
model TicketCategory {
  id          Int      @id @default(autoincrement())
  panelId     Int
  name        String   // e.g. "Support", "Bewerbung", "Bug Report"
  emoji       String   @default("ðŸŽ«")
  description String?  // shown in dropdown description
  style       String   @default("PRIMARY") // button style: PRIMARY, SECONDARY, SUCCESS, DANGER
  categoryId  String?  // Discord category channel override (null = use panel default)
  order       Int      @default(0) // display order
  createdAt   DateTime @default(now())

  panel   TicketPanel @relation(fields: [panelId], references: [id], onDelete: Cascade)
  tickets Ticket[]

  @@index([panelId])
  @@map("ticket_categories")
}

// â”€â”€â”€ Tickets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Ticket {
  id          Int      @id @default(autoincrement())
  guildId     String
  channelId   String   @unique // the ticket channel
  userId      String   // who opened the ticket
  panelId     Int?     // which panel created it (null = manual)
  ticketCategoryId Int? // which category within the panel
  number      Int      // ticket number (per-guild sequential)
  topic       String   @default("general")
  status      String   @default("open") // open, claimed, closed
  claimedBy   String?  // staff member who claimed
  closedBy    String?  // who closed the ticket
  closedAt    DateTime?
  reason      String?  // close reason
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  panel          TicketPanel?    @relation(fields: [panelId], references: [id], onDelete: SetNull)
  ticketCategory TicketCategory? @relation(fields: [ticketCategoryId], references: [id], onDelete: SetNull)
  transcript     TicketTranscript?

  @@index([guildId])
  @@index([guildId, userId])
  @@index([guildId, status])
  @@index([guildId, number])
  @@map("tickets")
}

// â”€â”€â”€ Ticket Transcripts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model TicketTranscript {
  id          Int      @id @default(autoincrement())
  ticketId    Int      @unique
  guildId     String
  userId      String   // ticket opener
  channelName String
  messageCount Int     @default(0)
  html        String   @db.Text // full HTML transcript
  messages    String?  @db.Text // JSON array of message objects for React rendering
  createdAt   DateTime @default(now())

  ticket Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([guildId])
  @@index([guildId, userId])
  @@map("ticket_transcripts")
}

// â”€â”€â”€ Giveaways â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Giveaway {
  id            Int      @id @default(autoincrement())
  guildId       String
  channelId     String
  messageId     String?  // Discord message ID
  hostId        String   // who created the giveaway
  prize         String
  description   String?  @db.Text
  winnerCount   Int      @default(1)
  emoji         String   @default("ðŸŽ‰")
  bannerUrl     String?  @db.Text // custom banner image URL (uploaded via dashboard)
  status        String   @default("active") // active, ended, cancelled
  startsAt      DateTime @default(now())
  endsAt        DateTime
  endedAt       DateTime?

  // Requirements
  requiredRoles    String  @default("[]") // JSON array of role IDs (must have ANY)
  blacklistRoles   String  @default("[]") // JSON array of role IDs
  blacklistUsers   String  @default("[]") // JSON array of user IDs
  bonusRoles       String  @default("[]") // JSON array of { roleId, entries }
  minServerJoinDays Int    @default(0)    // min days in server
  minMessages      Int     @default(0)    // min messages in server
  minInvites       Int     @default(0)    // min invites
  minLevel         Int     @default(0)    // min level required

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  entries  GiveawayEntry[]
  winners  GiveawayWinner[]

  @@index([guildId])
  @@index([guildId, status])
  @@index([status, endsAt])
  @@map("giveaways")
}

// â”€â”€â”€ Giveaway Entries â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model GiveawayEntry {
  id          Int      @id @default(autoincrement())
  giveawayId  Int
  userId      String
  entries     Int      @default(1) // bonus entries from roles
  createdAt   DateTime @default(now())

  giveaway Giveaway @relation(fields: [giveawayId], references: [id], onDelete: Cascade)

  @@unique([giveawayId, userId])
  @@index([giveawayId])
  @@map("giveaway_entries")
}

// â”€â”€â”€ Giveaway Winners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model GiveawayWinner {
  id          Int      @id @default(autoincrement())
  giveawayId  Int
  userId      String
  rerolled    Boolean  @default(false)
  createdAt   DateTime @default(now())

  giveaway Giveaway @relation(fields: [giveawayId], references: [id], onDelete: Cascade)

  @@index([giveawayId])
  @@map("giveaway_winners")
}

// â”€â”€â”€ Bot Stats (aggregated) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model BotStats {
  id            Int      @id @default(autoincrement())
  guildCount    Int      @default(0)
  userCount     Int      @default(0)
  commandsUsed  Int      @default(0)
  uptime        BigInt   @default(0)
  recordedAt    DateTime @default(now())

  @@map("bot_stats")
}
